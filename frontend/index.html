<!-- INDEX_FRAME_FIX_1769019546 -->
<!-- INDEX_FIX_1769018995 -->
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TESOURA</title>

  <!-- Base (pode existir no projeto) -->
  <link rel="stylesheet" href="app/css/ui.css?v=1" />

  <!-- Evitar cache do INDEX -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#0b1220;color:#fff}

    .topbar{
      background:#111827;padding:10px 20px;color:#ff7f27;font-weight:900;font-size:18px;
      display:flex;align-items:center;justify-content:space-between;gap:12px
    }
    .topbar .actions{display:flex;align-items:center;gap:8px}
    .mode{font-size:12px;color:#fff;opacity:.95;background:#0b1220;border:1px solid #334155;padding:4px 8px;border-radius:999px}
    .topbar button{border:none;border-radius:8px;padding:7px 11px;font-weight:900;cursor:pointer}
    .btn-logout{background:#ef4444;color:#fff;display:none}

    .tabs{display:flex;background:#111827;border-bottom:2px solid #ff7f27}
    .tab-btn{
      flex:1;padding:10px;cursor:pointer;text-align:center;border:none;
      background:#111827;color:#fff;font-weight:900;font-size:14px
    }
    .tab-btn.active{background:#1f2937;color:#ff7f27;border-bottom:3px solid #ff7f27}

    .frame-wrap{height:calc(100vh - 80px);background:#0b1220}
    iframe{width:100%;height:100%;border:none;background:#0b1220}

    /* TELA INICIAL (SENHA) */
    #telaInicial{
      position:fixed;inset:0;z-index:9998;display:flex;align-items:center;justify-content:center;
      padding:16px;background:rgba(0,0,0,.80)
    }
    #telaInicial .box{
      width:min(520px,100%);background:#081427;border:1px solid #334155;border-radius:14px;
      padding:18px;text-align:center
    }
    #telaInicial .t1{color:#ff7f27;font-weight:900;font-size:22px}
    #telaInicial .t2{color:#e5e7eb;margin-top:8px;font-weight:800}
    #telaInicial .t3{color:#e5e7eb;margin-top:18px;font-weight:900}
    #telaInicial .row{display:flex;gap:14px;justify-content:center;margin-top:18px;flex-wrap:wrap}
    #telaInicial .btnJ{
      min-width:200px;border:none;border-radius:10px;padding:12px 14px;font-weight:900;cursor:pointer;
      background:#22c55e;color:#052e16
    }
    #telaInicial .btnD{
      min-width:200px;border:none;border-radius:10px;padding:12px 14px;font-weight:900;cursor:pointer;
      background:#3b82f6;color:#06162f
    }
    #telaInicial .msg{margin-top:12px;color:#e5e7eb;font-size:12px;min-height:16px}
    noscript{display:block;padding:12px;background:#b91c1c;color:#fff;font-weight:900;text-align:center}
  </style>

  <script>
    // ===== SENHAS (OFICIAL) =====
    const PIN_JOGADORES = "TESOURA2026"; // Jogadores (visual)
    const PINS_DIR_FULL = ["1baidec","2thiago"]; // Diretoria FULL (tudo)
    const PINS_DIR_SEM_CAIXA = ["3love","4le","5titi"]; // Diretoria sem Caixa

    function qs(id){ return document.getElementById(id); }

    function cacheBust(url){
      const sep = url.includes("?") ? "&" : "?";
      return url + sep + "cb=" + Date.now();
    }

    function setBadge(txt){
      const b = qs("modeBadge");
      if(b) b.textContent = txt;
    }

    function showTelaInicial(v){
      const t = qs("telaInicial");
      if(t) t.style.display = v ? "flex" : "none";
      const m = qs("msgTelaInicial");
      if(m) m.textContent = "";
    }

    function showLogout(v){
      const b = qs("btnLogout");
      if(b) b.style.display = v ? "inline-block" : "none";
    }

    async function disableServiceWorker(){
      try{
        if("serviceWorker" in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          for(const r of regs){ await r.unregister(); }
        }
      }catch(e){}
      try{
        if("caches" in window){
          const keys = await caches.keys();
          for(const k of keys){ await caches.delete(k); }
        }
      }catch(e){}
    }

    function pedirSenha(titulo){
      const s = prompt(titulo);
      if(s === null) return null;
      return String(s).trim();
    }

    function marcarAbaAtiva(key){
      document.querySelectorAll(".tab-btn").forEach(b=>{
        b.classList.toggle("active", b.dataset.panel === key);
      });
    }

    function aplicarPermissoesTabs(){
      // esconde/mostra abas conforme modo
      const tabMensalidade = qs("tab_mensalidade");
      const tabCaixa = qs("tab_caixa");

      // padrão: mostra tudo
      if(tabMensalidade) tabMensalidade.style.display = "";
      if(tabCaixa) tabCaixa.style.display = "";

      if(window.TESOURA_ROLE === "jogador"){
        // jogador não vê financeiro
        if(tabMensalidade) tabMensalidade.style.display = "none";
        if(tabCaixa) tabCaixa.style.display = "none";
      }

      if(window.TESOURA_ROLE === "dir_sem_caixa"){
        if(tabCaixa) tabCaixa.style.display = "none";
      }
    }

    function podeAbrirPanel(key){
      if(window.TESOURA_ROLE === "bloqueado") return false;
      if(window.TESOURA_ROLE === "jogador" && (key === "mensalidade" || key === "caixa")) return false;
      if(window.TESOURA_ROLE === "dir_sem_caixa" && key === "caixa") return false;
      return true;
    }

    function travarIframeJogador(iframe){
      try{
        const doc = iframe.contentDocument || iframe.contentWindow?.document;
        if(!doc || !doc.body) return;

        let banner = doc.getElementById("TESOURA_JOGADOR_BANNER");
        if(!banner){
          banner = doc.createElement("div");
          banner.id = "TESOURA_JOGADOR_BANNER";
          banner.textContent = "MODO JOGADOR: SOMENTE VISUALIZAÇÃO";
          banner.style.cssText =
            "position:fixed;top:0;left:0;right:0;z-index:999999;" +
            "background:#b91c1c;color:#fff;font-weight:900;" +
            "padding:8px 10px;text-align:center;font-size:12px;";
          doc.body.appendChild(banner);
          doc.body.style.paddingTop = "40px";
        }

        let style = doc.getElementById("TESOURA_JOGADOR_LOCK");
        if(!style){
          style = doc.createElement("style");
          style.id = "TESOURA_JOGADOR_LOCK";
          style.textContent = `
            input, select, textarea {
              pointer-events:none !important;
              opacity:0.60 !important;
              cursor:not-allowed !important;
            }
            button, a, [role="button"], [onclick]{
              pointer-events:none !important;
              opacity:0.55 !important;
              cursor:not-allowed !important;
            }
          `;
          (doc.head || doc.documentElement).appendChild(style);
        }

        // libera botões de VISUALIZAÇÃO (PDF / carregar / histórico)
        const allowRe = /(PDF|CARREGAR|ATUALIZAR|HISTÓRICO|HISTORICO|LISTA|SELECIONADO)/i;
        doc.querySelectorAll("button,a,[role='button']").forEach(el=>{
          const t = (el.textContent || "").trim();
          if(allowRe.test(t)){
            el.style.pointerEvents = "auto";
            el.style.opacity = "1";
            el.style.cursor = "pointer";
            el.style.filter = "none";
          }
        });

      }catch(e){}
    }

    function aplicarModoNoIframe(){
      const iframe = qs("frame");
      if(!iframe) return;
      if(window.TESOURA_ROLE === "jogador") travarIframeJogador(iframe);
    }

    function openPanel(key){
      if(!podeAbrirPanel(key)){
        // se tentar abrir algo bloqueado, volta para jogadores
        key = "jogadores";
      }
      const iframe = qs("frame");
      const panels = {
        jogadores: "panels/jogadores.html",
        presenca_escalacao: "panels/presenca_escalacao.html",
        controle_geral: "panels/controle_geral.html",
        mensalidade: "panels/mensalidade.html",
        caixa: "panels/caixa.html",
        gols: "panels/gols.html",
      };
      marcarAbaAtiva(key);
      if(iframe){
        iframe.src = "about:blank";
        setTimeout(()=>{ iframe.src = cacheBust(panels[key] || panels.jogadores); }, 0);
      }
      location.hash = "#" + key;
    }

    function entrarJogadores(){
      const pin = pedirSenha("Digite a senha (JOGADORES):");
      if(pin === null) return;

      if(String(pin) !== String(PIN_JOGADORES)){
        qs("msgTelaInicial").textContent = "Senha incorreta.";
        alert("Senha incorreta.");
        return;
      }

      window.TESOURA_ROLE = "jogador";
      setBadge("Modo: Jogadores (visual)");
      showTelaInicial(false);
      showLogout(true);
      aplicarPermissoesTabs();

      const start = (location.hash || "").replace("#","") || "jogadores";
      openPanel(start);
    }

    function entrarDiretoria(){
      const pin = pedirSenha("Digite a senha (DIRETORIA):");
      if(pin === null) return;

      if(PINS_DIR_FULL.includes(pin)){
        window.TESOURA_ROLE = "dir_full";
        setBadge("Modo: Diretoria");
      }else if(PINS_DIR_SEM_CAIXA.includes(pin)){
        window.TESOURA_ROLE = "dir_sem_caixa";
        setBadge("Modo: Diretoria (sem Caixa)");
      }else{
        qs("msgTelaInicial").textContent = "Senha incorreta.";
        alert("Senha incorreta.");
        return;
      }

      showTelaInicial(false);
      showLogout(true);
      aplicarPermissoesTabs();

      const start = (location.hash || "").replace("#","") || "jogadores";
      // se for sem caixa e cair em #caixa, corrige
      openPanel(start);
    }

    function sair(){
      window.TESOURA_ROLE = "bloqueado";
      setBadge("Modo: —");
      showLogout(false);
      showTelaInicial(true);

      // volta para jogadores no hash, mas sem abrir painel sem login
      location.hash = "#jogadores";
      const iframe = qs("frame");
      if(iframe) iframe.src = "about:blank";
      aplicarPermissoesTabs();
    }

    window.addEventListener("load", async ()=>{
      await disableServiceWorker();

      // regra: sempre pedir senha ao abrir
      window.TESOURA_ROLE = "bloqueado";
      setBadge("Modo: —");
      showLogout(false);
      showTelaInicial(true);
      aplicarPermissoesTabs();

      // ativa cliques das abas (só depois de entrar)
      document.querySelectorAll(".tab-btn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const key = btn.dataset.panel;
          if(window.TESOURA_ROLE === "bloqueado") return;
          openPanel(key);
        });
      });

      qs("btnEntrarJog").addEventListener("click", entrarJogadores);
      qs("btnEntrarDir").addEventListener("click", entrarDiretoria);
      qs("btnLogout").addEventListener("click", sair);

      // aplica trava no iframe quando carregar
      qs("frame").addEventListener("load", ()=>aplicarModoNoIframe());
    });
  </script>

<style>
/* FIX_IFRAME_PANELS_VISIBLE */
/* garante que painel em iframe apareça (altura/visibilidade) */
main iframe, #panelHost iframe, #panelContainer iframe, #panel iframe {
  width: 100%;
  height: 78vh;
  min-height: 650px;
  border: 0;
  display: block;
}
#panelHost, #panelContainer, #panel, main {
  min-height: 78vh;
}
</style>


<style>
/* FIX_FRAME_FORCE_VISIBLE */
#frame{
  width:100% !important;
  height:78vh !important;
  min-height:650px !important;
  display:block !important;
  border:2px solid #ff8a2a !important; /* só pra enxergar */
  background:#0b1220 !important;
}
</style>

</head>

<body>
  <noscript>Ative o JavaScript no navegador para usar o TESOURA.</noscript>

  <!-- TELA INICIAL -->
  <div id="telaInicial">
    <div class="box">
      <div class="t1">GRUPO TESOURA I</div>
      <div class="t2">ESPORTE, FAMÍLIA E AMIZADE</div>
      <div class="t3">APLICATIVO DO GRUPO</div>

      <div class="row">
        <button class="btnJ" id="btnEntrarJog">ENTRAR JOGADORES</button>
        <button class="btnD" id="btnEntrarDir">ENTRAR DIRETORIA</button>
      </div>

      <div class="msg" id="msgTelaInicial"></div>
    </div>
  </div>

  <div class="topbar">
    <div>TESOURA – CONTROLE DO FUTEBOL</div>
    <div class="actions">
      <div class="mode" id="modeBadge">Modo: —</div>
      <button class="btn-logout" id="btnLogout">SAIR</button>
    </div>
  </div>

  <div class="tabs">
    <button class="tab-btn active" id="tab_jogadores" data-panel="jogadores">JOGADORES</button>
    <button class="tab-btn" id="tab_presenca" data-panel="presenca_escalacao">PRESENÇA / ESCALAÇÃO</button>
    <button class="tab-btn" id="tab_controle" data-panel="controle_geral">CONTROLE GERAL</button>
    <button class="tab-btn" id="tab_mensalidade" data-panel="mensalidade">MENSALIDADE</button>
    <button class="tab-btn" id="tab_caixa" data-panel="caixa">CAIXA</button>
    <button class="tab-btn" id="tab_gols" data-panel="gols">GOLS</button>
  </div>

  <div class="frame-wrap">
    <iframe id="frame" title="TESOURA"></iframe>
  </div>

  </body>
</html>
