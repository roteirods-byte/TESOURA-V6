<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>TESOURA - PRESENÇA / ESCALAÇÃO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body{margin:0;padding:0;font-family:Arial,sans-serif;background:#0f172a;color:#f9fafb;font-size:12px}
    header{background:#020617;padding:12px 16px;text-align:center;font-weight:bold;letter-spacing:1px;text-transform:uppercase}
    .container{max-width:1400px;margin:0 auto;padding:16px}
    h2{margin:8px 0;color:#f97316;text-transform:uppercase}
    .painel{background:#020617;border-radius:10px;padding:10px;box-shadow:0 2px 10px rgba(0,0,0,0.35);margin-bottom:14px;font-size:12px}
    .linhas-topo{display:flex;gap:16px;margin-bottom:16px}
    .col-50{flex:1;min-width:0}

    button, input{
      padding:6px 10px;border-radius:6px;border:none;cursor:pointer;font-weight:bold;
      text-transform:uppercase;font-size:11px;line-height:1;height:30px;min-width:110px;
    }
    input{
      border:1px solid #334155;background:#0b1120;color:#f9fafb;text-transform:none;
      min-width:140px;font-weight:700;
    }

    .btn-primario{background:#22c55e;color:#022c22}
    .btn-secundario{background:#0ea5e9;color:#0f172a}
    .btn-perigo{background:#ef4444;color:#f9fafb}
    .btn-neutro{background:#f97316;color:#0f172a}
    .btn-chegou{background:#10b981;color:#022c22;min-width:120px}
    .btn-nao-joga{background:#64748b;color:#e5e7eb;min-width:140px}
    .btn-excluir{background:#ef4444;color:#f9fafb;min-width:90px}

    table{width:100%;border-collapse:collapse;margin-top:8px;background:#020617;font-size:11px}
    th,td{border:1px solid #334155;padding:2px 4px;text-align:center;text-transform:uppercase;white-space:nowrap;font-size:11px}
    th{background:#111827;color:#f97316;position:sticky;top:0;z-index:1}
    tr:nth-child(even){background:#0b1120}
    tr:nth-child(odd){background:#020617}

    .status-info{font-size:12px;margin-top:6px;color:#cbd5e1}
    .painel-scroll{overflow-y:auto;max-height:320px}
    .riscado{text-decoration:line-through;opacity:.55}

    .grid-escalacao{display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start}
    @media (max-width: 980px){.grid-escalacao{grid-template-columns:1fr}}

    .totais{font-weight:bold;text-align:right;margin-top:6px;font-size:12px;color:#cbd5e1}
    .msg{font-size:12px;color:#cbd5e1;margin-top:6px}
    .msg-erro{color:#ef4444;font-weight:bold}
    .msg-ok{color:#22c55e;font-weight:bold}

    .linha-acoes{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .clock-box{font-size:12px;color:#cbd5e1;padding:6px 10px;border:1px solid rgba(148,163,184,0.25);border-radius:10px;background:rgba(15,23,42,0.35);height:30px;display:flex;align-items:center}

    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-weight:800;font-size:11px}
    .b-azul{background:#1d4ed8;color:#fff}
    .b-amarelo{background:#facc15;color:#0f172a}
    .b-verde{background:#22c55e;color:#0f172a}
    .b-vermelho{background:#ef4444;color:#fff}
  </style>
</head>

<body>
  <header>TESOURA - PRESENÇA / ESCALAÇÃO</header>

  <div class="container">

    <div class="painel">
      <div class="linha-acoes">
        <div class="status-info" style="margin:0;font-weight:800;color:#f97316">DATA DO JOGO:</div>
        <input id="inpData" type="text" placeholder="DD/MM/AAAA" />
        <button id="btnRecarregar" class="btn-secundario">RECARREGAR</button>
        <div id="msgTopo" class="msg" style="margin:0"></div>
      </div>
    </div>

    <div class="linhas-topo">

      <!-- JOGADORES -->
      <div class="col-50">
        <div class="painel">
          <h2>Jogadores (todos)</h2>
          <div class="status-info">Clique em <b>CHEGOU AGORA</b> quando o jogador chegar.</div>
          <div id="statusJogadores" class="status-info"></div>

          <div class="painel-scroll">
            <table>
              <thead>
                <tr>
                  <th style="width:70px">ID</th>
                  <th>APELIDO</th>
                  <th style="width:170px">CHEGOU</th>
                </tr>
              </thead>
              <tbody id="tbJogadores"></tbody>
            </table>
          </div>

          <div class="totais" id="totJogadores"></div>
        </div>
      </div>

      <!-- PRESENÇA HOJE -->
      <div class="col-50">
        <div class="painel" id="painelPresencaHoje">
          <h2>Presença hoje</h2>

          <div class="linha-acoes" style="margin-top:8px">
            <button id="btnLimpar" class="btn-perigo">LIMPAR HOJE</button>
            <button id="btnEscalar1T" class="btn-primario">ESCALAR 1º TEMPO</button>

            <!-- marcador de hora acima do desfazer 1T -->
            <div id="horaAcimaDesfazer1T" class="clock-box">Hora agora: --:--</div>

            <button id="btnDesfazer1T" class="btn-neutro">DESFAZER 1º TEMPO</button>
            <button id="btnPdfPresenca" class="btn-neutro">BAIXAR PDF</button>
          </div>

          <div class="msg" id="infoPresenca"></div>

          <div class="painel-scroll" style="max-height:360px">
            <table id="tblPresenca">
              <thead>
                <tr>
                  <th style="width:70px">ID</th>
                  <th style="width:70px">ORDEM</th>
                  <th>APELIDO</th>
                  <th style="width:90px">HORA</th>
                  <th style="width:90px">OBS</th>
                  <th style="width:130px">NÃO VAI JOGAR</th>
                  <th style="width:90px">EXCLUIR</th>
                </tr>
              </thead>
              <tbody id="tbPresenca"></tbody>
            </table>
          </div>

          <div class="totais" id="totPresenca"></div>
        </div>
      </div>
    </div>

    <!-- ESCALAÇÃO -->
    <div class="painel" id="painelEscalacao">
      <h2>Escalação do jogo</h2>

      <div class="linha-acoes" style="margin-top:8px">
        <div class="clock-box" id="horaAgoraEscalacao">Hora agora: --:--</div>
        <button id="btnEscalar2T" class="btn-primario">ESCALAR 2º TEMPO</button>
        <button id="btnDesfazer2T" class="btn-neutro">DESFAZER 2º TEMPO</button>
        <button id="btnPdf1T" class="btn-neutro">BAIXAR PDF 1º TEMPO</button>
        <button id="btnPdf2T" class="btn-neutro">BAIXAR PDF 2º TEMPO</button>
      </div>

      <div class="msg" id="infoEscalacao"></div>

      <div class="grid-escalacao" style="margin-top:10px">
        <div class="painel" id="painelEscalacao1T">
          <h2>1º tempo</h2>
          <div class="painel-scroll" style="max-height:360px">
            <table id="tbl1T">
              <thead>
                <tr>
                  <th style="width:90px">TIME</th>
                  <th>APELIDO</th>
                  <th style="width:110px">POSIÇÃO</th>
                  <th style="width:90px">OBS</th>
                </tr>
              </thead>
              <tbody id="tb1T"></tbody>
            </table>
          </div>
        </div>

        <div class="painel" id="painelEscalacao2T">
          <h2>2º tempo</h2>
          <div class="painel-scroll" style="max-height:360px">
            <table id="tbl2T">
              <thead>
                <tr>
                  <th style="width:90px">TIME</th>
                  <th>APELIDO</th>
                  <th style="width:110px">POSIÇÃO</th>
                  <th style="width:90px">OBS</th>
                </tr>
              </thead>
              <tbody id="tb2T"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- PDF de ARQUIVO (texto/tabela, não print) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.4/dist/jspdf.plugin.autotable.min.js"></script>

  <script>
    // =================== UTIL ===================
    function pad2(n){ return String(n).padStart(2,"0"); }
    function ymd(d){ return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`; }
    function ymdToBr(s){
      s = String(s||"").trim();
      if(!s) return "";
      if(s.includes("/")) return s;
      const m = s.match(/^(\d{4})-(\d{2})-(\d{2})$/);
      return m ? `${m[3]}/${m[2]}/${m[1]}` : s;
    }
    function brToIso(s){
      s = String(s||"").trim();
      const m = s.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
      return m ? `${m[3]}-${m[2]}-${m[1]}` : s;
    }
    function proximoDomingoISO(){
      const d = new Date();
      const add = (7 - d.getDay()) % 7; // 0=domingo
      d.setDate(d.getDate()+add);
      return ymd(d);
    }
    function nowLocalStr(){
      const d = new Date();
      return `${ymd(d)} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    }
    function nowHHMM(){
      const d = new Date();
      return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    }

    const elInpData = document.getElementById("inpData");
    const elMsgTopo = document.getElementById("msgTopo");

    const elTbJog = document.getElementById("tbJogadores");
    const elTotJog = document.getElementById("totJogadores");
    const elStatusJog = document.getElementById("statusJogadores");

    const elTbPres = document.getElementById("tbPresenca");
    const elTotPres = document.getElementById("totPresenca");
    const elInfoPres = document.getElementById("infoPresenca");

    const elTb1T = document.getElementById("tb1T");
    const elTb2T = document.getElementById("tb2T");
    const elInfoEsc = document.getElementById("infoEscalacao");

    function setMsg(el, txt, ok){
      el.classList.remove("msg-ok","msg-erro");
      el.classList.add(ok ? "msg-ok" : "msg-erro");
      el.textContent = txt || "";
    }

    async function apiGet(url){
      const r = await fetch(url, { method:"GET" });
      const j = await r.json().catch(()=>null);
      return { r, j };
    }

    async function apiPost(url, body){
      const r = await fetch(url, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(body||{})
      });
      const j = await r.json().catch(()=>null);
      return { r, j };
    }

    async function postTry(urls, body){
      for(const u of urls){
        try{
          const { r, j } = await apiPost(u, body);
          if(r && r.ok && j && j.ok) return { ok:true, used:u, j };
          // se for 404/405 tenta próxima
          if(r && (r.status===404 || r.status===405)) continue;
          // se respondeu JSON ok:false, para e mostra erro real
          if(j && j.ok===false) return { ok:false, used:u, j };
        }catch(e){
          // tenta próxima
        }
      }
      return { ok:false, used:null, j:{ ok:false, error:"Rota da API não encontrada (rotas tentadas falharam)." } };
    }

    function dataISOAtual(){
      const br = String(elInpData.value||"").trim();
      if(!br) return proximoDomingoISO();
      const iso = brToIso(br);
      return iso.match(/^\d{4}-\d{2}-\d{2}$/) ? iso : proximoDomingoISO();
    }

    function nomePdf(prefix){
      const dISO = dataISOAtual();
      const dBR = ymdToBr(dISO).replaceAll("/","-");
      return `${prefix}-${dBR}.pdf`;
    }

    // =================== RENDER ===================
    function renderJogadores(items, presencas){
      elTbJog.innerHTML = "";
      const mapPres = new Set((presencas||[]).map(p => String(p.id)));
      (items||[]).forEach(it=>{
        const id = it.id ?? it.ID ?? it.player_id ?? it.jogador_id;
        const apelido = (it.apelido ?? it.APELIDO ?? it.nome ?? it.name ?? "").toString();
        const tr = document.createElement("tr");

        const tdId = document.createElement("td"); tdId.textContent = id;
        const tdAp = document.createElement("td"); tdAp.textContent = apelido;

        const tdBtn = document.createElement("td");
        const b = document.createElement("button");
        b.className = "btn-chegou";
        b.textContent = mapPres.has(String(id)) ? "JÁ CHEGOU" : "CHEGOU AGORA";
        b.disabled = mapPres.has(String(id));
        b.onclick = ()=>chegouAgora(id);
        tdBtn.appendChild(b);

        tr.appendChild(tdId); tr.appendChild(tdAp); tr.appendChild(tdBtn);
        elTbJog.appendChild(tr);
      });

      elTotJog.textContent = `TOTAL DE JOGADORES: ${(items||[]).length}`;
    }

    function renderPresenca(items){
      elTbPres.innerHTML = "";
      const arr = items || [];
      arr.forEach((p, idx)=>{
        const id = p.id ?? p.ID ?? p.jogador_id ?? p.player_id;
        const ordem = p.ordem ?? p.ORDEM ?? (idx+1);
        const apelido = (p.apelido ?? p.APELIDO ?? p.nome ?? "").toString();
        const hora = (p.hora ?? p.HORA ?? "").toString();
        const obs = (p.obs ?? p.OBS ?? "").toString();
        const naoJoga = !!(p.nao_vai_jogar ?? p.naoJoga ?? p.NAO_VAI_JOGAR ?? p.nao_joga);

        const tr = document.createElement("tr");
        if(naoJoga) tr.classList.add("riscado");

        const tdId = document.createElement("td"); tdId.textContent = id;
        const tdOr = document.createElement("td"); tdOr.textContent = ordem;
        const tdAp = document.createElement("td"); tdAp.textContent = apelido;
        const tdHr = document.createElement("td"); tdHr.textContent = hora;
        const tdObs = document.createElement("td"); tdObs.textContent = obs;

        const tdNao = document.createElement("td");
        const bNao = document.createElement("button");
        bNao.className = "btn-nao-joga";
        bNao.textContent = naoJoga ? "DESMARCAR" : "NÃO VAI JOGAR";
        bNao.onclick = ()=>toggleNaoVaiJogar(id);
        tdNao.appendChild(bNao);

        const tdEx = document.createElement("td");
        const bEx = document.createElement("button");
        bEx.className = "btn-excluir";
        bEx.textContent = "EXCLUIR";
        bEx.onclick = ()=>excluirPresenca(id);
        tdEx.appendChild(bEx);

        tr.appendChild(tdId); tr.appendChild(tdOr); tr.appendChild(tdAp);
        tr.appendChild(tdHr); tr.appendChild(tdObs); tr.appendChild(tdNao); tr.appendChild(tdEx);
        elTbPres.appendChild(tr);
      });

      elTotPres.textContent = `PRESENTES HOJE: ${arr.length}`;
    }

    function badgeTime(val){
      const v = String(val||"").toUpperCase().trim();
      const span = document.createElement("span");
      span.className = "badge";
      // garante AZUL na coluna TIME
      if(v.includes("AZUL")) { span.classList.add("b-azul"); span.textContent = "AZUL"; return span; }
      if(v.includes("AMARELO")) { span.classList.add("b-amarelo"); span.textContent = "AMARELO"; return span; }
      if(v.includes("VERDE")) { span.classList.add("b-verde"); span.textContent = "VERDE"; return span; }
      if(v.includes("VERMELHO")) { span.classList.add("b-vermelho"); span.textContent = "VERMELHO"; return span; }
      span.style.background = "#334155"; span.style.color = "#fff"; span.textContent = v || "-";
      return span;
    }

    function renderEscalacao(tbEl, items){
      tbEl.innerHTML = "";
      (items||[]).forEach(it=>{
        // tenta campos comuns
        const time = it.time ?? it.TIME ?? it.cor ?? it.COR ?? it.time_cor ?? it.team ?? it.TIMES;
        const apelido = (it.apelido ?? it.APELIDO ?? it.nome ?? it.NAME ?? "").toString();
        const pos = (it.posicao ?? it.POSICAO ?? it.pos ?? "").toString();
        const obs = (it.obs ?? it.OBS ?? it.status ?? "").toString();

        const tr = document.createElement("tr");

        const tdTime = document.createElement("td");
        tdTime.appendChild(badgeTime(time));

        const tdAp = document.createElement("td"); tdAp.textContent = apelido;
        const tdPos = document.createElement("td"); tdPos.textContent = pos;
        const tdObs = document.createElement("td"); tdObs.textContent = obs;

        tr.appendChild(tdTime); tr.appendChild(tdAp); tr.appendChild(tdPos); tr.appendChild(tdObs);
        tbEl.appendChild(tr);
      });
    }

    // =================== ESTADO ===================
    let STATE = null;

    async function carregar(){
      const data_domingo = dataISOAtual();
      const now_local = nowLocalStr();

      elMsgTopo.textContent = `Carregando... (domingo: ${ymdToBr(data_domingo)})`;
      elMsgTopo.className = "msg";

      const url = `/api/presenca_escalacao/state?data_domingo=${encodeURIComponent(data_domingo)}&now_local=${encodeURIComponent(now_local)}`;
      const { r, j } = await apiGet(url);

      if(!j || !j.ok){
        setMsg(elMsgTopo, "ERRO ao carregar painel: " + (j?.error || ("HTTP "+(r?.status||"?"))), false);
        return;
      }

      STATE = j;

      const jogadores = j.jogadores || j.players || j.lista_jogadores || [];
      const presencas = j.presencas || j.presenca || j.presentes || [];
      const esc1 = j.escalacao_1t || j.escalacao1t || j.escalacao1T || j.esc1t || [];
      const esc2 = j.escalacao_2t || j.escalacao2t || j.escalacao2T || j.esc2t || [];

      renderJogadores(jogadores, presencas);
      renderPresenca(presencas);
      renderEscalacao(elTb1T, esc1);
      renderEscalacao(elTb2T, esc2);

      setMsg(elMsgTopo, `OK: painel carregado (domingo: ${ymdToBr(data_domingo)})`, true);
      elInfoPres.textContent = `Lista carregada. (Domingo: ${data_domingo})`;
      elInfoEsc.textContent = `Escalações carregadas. (Domingo: ${data_domingo})`;
    }

    // =================== AÇÕES (API) ===================
    async function chegouAgora(id){
      const data_domingo = dataISOAtual();
      const now_local = nowLocalStr();

      setMsg(elStatusJog, "Salvando chegada...", true);

      const resp = await postTry([
        "/api/presenca_escalacao/chegou",
        "/api/presenca_escalacao/chegou_agora",
        "/api/presenca_escalacao/adicionar",
        "/api/presenca_escalacao/add"
      ], { id, data_domingo, now_local });

      if(!resp.ok){
        setMsg(elStatusJog, "ERRO ao marcar chegada: " + (resp.j?.error || "falha"), false);
        return;
      }

      setMsg(elStatusJog, "OK: chegada registrada.", true);
      await carregar();
    }

    async function toggleNaoVaiJogar(id){
      const data_domingo = dataISOAtual();

      const resp = await postTry([
        "/api/presenca_escalacao/nao_vai_jogar",
        "/api/presenca_escalacao/toggle_nao_joga",
        "/api/presenca_escalacao/nao_joga"
      ], { id, data_domingo });

      if(!resp.ok){
        setMsg(elInfoPres, "Erro ao alterar NÃO VAI JOGAR. " + (resp.j?.error || ""), false);
        return;
      }

      setMsg(elInfoPres, "OK: atualizado NÃO VAI JOGAR.", true);
      await carregar();
    }

    async function excluirPresenca(id){
      const data_domingo = dataISOAtual();

      const resp = await postTry([
        "/api/presenca_escalacao/excluir",
        "/api/presenca_escalacao/remover",
        "/api/presenca_escalacao/delete"
      ], { id, data_domingo });

      if(!resp.ok){
        setMsg(elInfoPres, "ERRO ao excluir: " + (resp.j?.error || "falha"), false);
        return;
      }

      setMsg(elInfoPres, "OK: excluído.", true);
      await carregar();
    }

    async function limparHoje(){
      const data_domingo = dataISOAtual();
      const resp = await apiPost("/api/presenca_escalacao/limpar", { data_domingo });
      if(!resp.j || !resp.j.ok){
        setMsg(elInfoPres, "ERRO ao limpar: " + (resp.j?.error || ("HTTP "+resp.r.status)), false);
        return;
      }
      setMsg(elInfoPres, "OK: lista limpa.", true);
      await carregar();
    }

    async function escalar(tempo){
      const data_domingo = dataISOAtual();
      const now_local = nowLocalStr();
      const resp = await apiPost("/api/presenca_escalacao/escalar", { data_domingo, tempo, now_local });
      if(!resp.j || !resp.j.ok){
        setMsg(elInfoEsc, "ERRO ao escalar "+tempo+": " + (resp.j?.error || ("HTTP "+resp.r.status)), false);
        return;
      }
      setMsg(elInfoEsc, "OK: escalação "+tempo+" gerada.", true);
      await carregar();
    }

    async function desfazer(tempo){
      const data_domingo = dataISOAtual();
      const resp = await apiPost("/api/presenca_escalacao/desfazer", { data_domingo, tempo });
      if(!resp.j || !resp.j.ok){
        setMsg(elInfoEsc, "ERRO ao desfazer "+tempo+": " + (resp.j?.error || ("HTTP "+resp.r.status)), false);
        return;
      }
      setMsg(elInfoEsc, "OK: desfazido "+tempo+".", true);
      await carregar();
    }

    // =================== PDF (ARQUIVO REAL) ===================
    function extrairTabelaParaPdf(tableId, titulo){
      const table = document.getElementById(tableId);
      const rows = [];
      const head = [];
      const ths = table.querySelectorAll("thead th");
      ths.forEach(th => head.push(th.textContent.trim()));

      const trs = table.querySelectorAll("tbody tr");
      trs.forEach(tr=>{
        const tds = tr.querySelectorAll("td");
        const line = [];
        tds.forEach((td, i)=>{
          // TIME pode ser badge
          const badge = td.querySelector(".badge");
          if(badge) line.push(badge.textContent.trim());
          else line.push(td.textContent.trim());
        });
        rows.push(line);
      });

      return { head, rows, titulo };
    }

    function gerarPdfTabela(prefix, titulo, tableId){
      if(!window.jspdf || !window.jspdf.jsPDF){
        alert("ERRO: PDF não carregou (jsPDF).");
        return;
      }
      const { head, rows } = extrairTabelaParaPdf(tableId, titulo);

      const doc = new window.jspdf.jsPDF({ orientation:"p", unit:"pt", format:"a4" });
      doc.setFont("helvetica","bold");
      doc.setFontSize(12);
      doc.text(titulo, 40, 40);

      doc.setFont("helvetica","normal");
      doc.setFontSize(9);

      doc.autoTable({
        startY: 55,
        head: [head],
        body: rows,
        styles: { fontSize: 8, cellPadding: 3 },
        headStyles: { fillColor: [249, 115, 22] }, // laranja (projeto)
        theme: "grid",
        margin: { left: 40, right: 40 }
      });

      doc.save(nomePdf(prefix));
    }

    function baixarPdfPresenca(){
      const data_domingo = dataISOAtual();
      gerarPdfTabela("TESOURA-PRESENCA", `PRESENÇA HOJE - ${ymdToBr(data_domingo)}`, "tblPresenca");
    }
    function baixarPdf1T(){
      const data_domingo = dataISOAtual();
      gerarPdfTabela("TESOURA-ESCALACAO-1T", `ESCALAÇÃO 1º TEMPO - ${ymdToBr(data_domingo)}`, "tbl1T");
    }
    function baixarPdf2T(){
      const data_domingo = dataISOAtual();
      gerarPdfTabela("TESOURA-ESCALACAO-2T", `ESCALAÇÃO 2º TEMPO - ${ymdToBr(data_domingo)}`, "tbl2T");
    }

    // =================== RELÓGIOS ===================
    function atualizarRelogios(){
      const hhmm = nowHHMM();
      const a = document.getElementById("horaAcimaDesfazer1T");
      const b = document.getElementById("horaAgoraEscalacao");
      if(a) a.textContent = "Hora agora: " + hhmm;
      if(b) b.textContent = "Hora agora: " + hhmm;
    }
    setInterval(atualizarRelogios, 1000);
    atualizarRelogios();

    // =================== BOTÕES ===================
    document.getElementById("btnRecarregar").onclick = carregar;

    document.getElementById("btnLimpar").onclick = limparHoje;
    document.getElementById("btnEscalar1T").onclick = ()=>escalar("1T");
    document.getElementById("btnDesfazer1T").onclick = ()=>desfazer("1T");
    document.getElementById("btnPdfPresenca").onclick = baixarPdfPresenca;

    document.getElementById("btnEscalar2T").onclick = ()=>escalar("2T");
    document.getElementById("btnDesfazer2T").onclick = ()=>desfazer("2T");
    document.getElementById("btnPdf1T").onclick = baixarPdf1T;
    document.getElementById("btnPdf2T").onclick = baixarPdf2T;

    // =================== INIT ===================
    // seta data padrão (próximo domingo) em BR
    (function init(){
      const iso = proximoDomingoISO();
      elInpData.value = ymdToBr(iso);
      carregar();
    })();
  </script>
</body>
</html>
